---
title: "代谢组部分"
author: "Shawn Wang"
date: Aug 22,2022
format: html
editor: visual
bibliography: PosDocProject.bib
---

<center>

<font color=salmon size=2pt> 🏡Zhang Lab, Aug 05, 2022 🏡</font>

<font color=green size=2pt> 🔬Multi-omics research center, State Key Laboratory of Crop Stress Adaption and Improvement, HENU, Kaifeng, Henan 🔬</font>

</center>

# 1. 方法

**取样方式描述：** 我们在野外进行了黄精块茎的采集，根据经验获取了不同生长年限的材料，粗略分为幼年材料`size1-3`和成年材料`size5-6`,`size4`介于幼年和成年材料之间。

## 1.1 实验方法

赵兵提供；

### Metabolites Extraction

All collected samples were flash frozen and ground to a fine powder with a mortar and pestle. The powder of each sample was extracted overnight using 80% HPLC grade methanol containing 1 μM chrysin as the internal standard and the ratio of the fresh weight to the volume of extraction solution was kept as 0.1 g/ml. The undissolved sample residues were precipitated by centrifugation at 13000 rpm for 30 min at 4℃. The clear supernatants were loaded into injection vials and ready for UHPLC-MS/MS.

### High-Performance Liquid Chromatography

For UHPLC-MS/MS assay, The vanquish-flex UHPLC system was coupled to Q Exactive Plus mass spectrometry (Thermo Fisher Scientific) for metabolite separation and detection. A Hypersil GOLD column (2.1×100 mm.1.9 um; Thermo Fisher Scientific) was employed for compound separation at 30°C and 5 μl of sample was loaded. The mobile phase A was HPLC grade H2O with 0.1% (v/v) formic acid (Merck, Germany) and phase B was HPLC grade acetonitrile (Merck, Germany). The gradient elution conditions were set as follows: From 0 to 2min, the mobile phase B increases to 10%; From 2 to 10min, the mobile phase B increases to 50%; From 10 to 10.1min， the mobile phase B increases to 80%; From 10.1 to 13 min, the mobile phase B was kept at 80%; From 13 to 14 min the mobile phase B increases to 95%; From 14-18 min the mobile phase B decreased to 10%. The flow rate was 0.3 ml/min. The MS data acquisition was performed by Q Exactive Plus (ThermoFisher Scientific, Rockford, IL) system. In full scan MS/ddMS2 mode, the resolutions of full scan MS and ddMS2 were set at 70000 and 17500, respectively. The automatic gain control (AGC) target and maximum injection time in full scan MS settings were 1e6 and 100 ms, while their values were 2e5 and 50 ms in dd MS2 settings. The TopN (N, the number of top most abundant ions for fragmentation) was set to 8, and collision energy was set to 20%, 40% and 60%. A heated ESI source was used at positive and negative ion mode. the spray voltage was set as 3.5 KV for positive mode and 3.2 KV for negative mode;The capillary temperature and aux gas heater temperature were set as 320 and 350 °C, respectively. Sheath gas and aux gas flow rate were set at 35 and 15 (in arbitrary units), respectively. The S-lens RF level was 50.

## 1.2 数据处理

1.  **数据格式转换：** 得到`.raw`的下机数据后，我们通过[docker版本的ProteoWizard msConvert](https://hub.docker.com/r/chambm/pwiz-skyline-i-agree-to-the-vendor-licenses) @adusumilliDataConversionProteoWizard2017 将原始数据转换为包含MS1信息的`.mzXML`格式，以及包含MS/MS信息的`.mgf`格式。

2.  **提峰、数据清洗：** 我们通过`tidymass` @shenTidyMassObjectorientedReproducible2022 对原始数据进行提峰，数据清洗分为以下几个步骤：

    2.1 缺失值检测， 首先对代谢物积累矩阵所有检测到的`feature`进行缺失值检测，统计。\
    2.2 噪音去除， 判断一个feature是否为noise的条件为：在所有QC样品中该feature的缺失频率大于20%。\
    2.3 批次效应检测，去除noise后通过对所有QC样本中feature峰面积统计可以观测到是否有batch effect。\
    2.4 缺失值填充，使用`tidymass`的`knn`算法填充缺失值。\
    2.5 数据归一化：使用`tidymass`支持向量机算法对数据进行归一化。 @shenNormalizationIntegrationLargescale2016。\
    2.6 数据整合。

3.  **代谢物注释：** 我们使用以下数据库对检测到的feature进行注释：

    3.1 [MassBank of North America, MoNA](https://mona.fiehnlab.ucdavis.edu/downloads) MS2;\
    3.2 [MassBank](https://massbank.eu/MassBank/) MS2;\
    3.3 [Human Metabolome Database, HMDB](https://hmdb.ca/downloads) MS2;\
    3.4 [Vaniya/Fiehn Natural Products Library](https://mona.fiehnlab.ucdavis.edu/spectra/browse?query=tags.text%3D%3D%22VF-NPL%22) MS2;\
    3.5 [RIKEN PlaSMA](https://mona.fiehnlab.ucdavis.edu/spectra/browse?query=tags.text%3D%3D%22RIKEN%20PlaSMA%22) MS2;\
    3.6 Tidymass 内置的RPLC、Fieh_hilic数据库 MS2；\
    3.7 [KNApSAcK](http://www.knapsackfamily.com/KNApSAcK/) MS1;\
    3.8 [PlantCyc](https://plantcyc.org/) MS1;\
    3.9 [KEGG](https://www.genome.jp/kegg/) MS1.\
    3.10 [MetDNA2](http://metdna.zhulab.cn/) 去噪后我们将剩余的feature的MS1及MS2的数据导出，通过`MetDNA2`对feature进行注释 MetDNA2 @shenMetabolicReactionNetworkbased2019；

4.  **注释过滤及整合：** 搜库的时候每个数据库会给出3个匹配度最高的candidates,我们会通过以下方式对注释进行过滤及去冗余：

    4.1 对于有MS/MS信息匹配成功的我们保留所有加合离子模式匹配，对于只有MS1匹配的feature，我们只保留`[M+H]+`以及`[M-H]-`的结果。\
    4.2 对于注释到同一代谢物的feature，优先保留有MS/MS信息的feature. 然后根据tidymass给出的匹配度总得分（Total score）选取得分最高的一个feature.\
    4.3 对于同一个feature注释到不同的代谢物的情况，我们还是优先保留MS/MS匹配的，次优先保留`[M+H]+`或者`[M-H]-`模式，最后再根据total score保留。 4.4 对于MetDNA的注释我们没有进行过多的处理，直接将结果整合进来。

5.  **代谢物分类：** 我们根据代谢物的`InChiKey`信息通过Classyfire @djoumboufeunangClassyFireAutomatedChemical2016 数据库将代谢物进行分类，为了更好的可视化分类结果，我们将分类结果中代谢物数量大于等于10个的称为major class，3-9的叫tiny class，小于3个的归类为other class.

6.  **PCA：**我们使用去噪后剩余的feature做PCA分析，首先对标准化后的峰面积做了log10的转换，用R包[PCAtools](http://mirrors.nju.edu.cn/bioconductor/3.15/bioc/html/PCAtools.html) 进行PCA计算，用[scatterplot3D包](https://cran.r-project.org/web/packages/scatterplot3d/index.html)进行可视化.

7.  **热图：** 我们将最终注释到的化合物通过[ComplexHeatmap](https://github.com/jokergoo/ComplexHeatmap) @guComplexHeatmapsReveal2016 进行了可视化，并且使用`column_km=12`以及`column_km_repeat = 5000`参数对代谢物做了5000次的重复的k-means分析,最终将代谢物分了12个cluster. 然后通过计算每个cluster的均值绘制了对应cluster的特征曲线。

# 2. 结果：

## 2.1 代谢物提峰，过滤，注释统计结果图表：


<center>**补充表1. 最终776个代谢物积累矩阵**</center>

```{r,message=FALSE, warning=FALSE, include=FALSE, out.width='100%'}
suppressMessages(library(bruceR))
```

```{r,echo=FALSE, message=FALSE, warning=FALSE,}
Tables1 <- import("../04.Result/01.Tables/TableS1.Accumulation_Matrix.xlsx",sheet = 1)
colnames(Tables1) = Tables1[1,]
Tables1 = Tables1[2:15,] %>% 
  mutate(Size_1 = as.numeric(Size_1),
         Size_2 = as.numeric(Size_2),
         Size_3 = as.numeric(Size_3),
         Size_4 = as.numeric(Size_4),
         Size_5 = as.numeric(Size_5),
         Size_6 = as.numeric(Size_6))
print_table(Tables1,digits = 2)
```

<center>**补充表2. 代谢物注释**</center>

```{r,echo=FALSE, message=FALSE, warning=FALSE,}
Tables2 <- import("../04.Result/01.Tables/TableS2.Compound_Annotation.xlsx",sheet = 1)
colnames(Tables2) = Tables2[1,]
Tables2 = Tables2[2:10,-7]
colnames(Tables2)[3] = "rt"
print_table(Tables2,digits = 2)
```

<center>**补充表3. 代谢物分类**</center>

```{r,echo=FALSE, message=FALSE, warning=FALSE}
Tables3 <- import("../04.Result/01.Tables/TableS3.Compound_classification.xlsx",sheet = 1)
colnames(Tables3) = Tables3[1,]
Tables3 = Tables3[2:10,]
colnames(Tables3)[3] = "rt"
print_table(Tables3,digits = 2)
```

## 2.2 不同年份黄精块茎非靶代谢组分析  

### 2.2.1 Overview

我们通过非靶向代谢组学技术鉴定了不同年份黄精的小分子代谢物含量。我们从正谱和负谱共检测出29125个feature， 经过去噪只剩下6618个feature，最终通过与数据库比对以及MetDNA2预测共注释到776个candidate metabolites做后续分析(Table 1)。通过严格的数据清洗我们发现所有的QC的样品在去噪后的feature PCA图中聚集在一起（Figure S2 A,B），说明系统误差被很好的消除，同时负谱中轻微的批次效应也被消除（Figure S1； Figure S2 A,B）。QC样品中标准化后的feature `RSD≤30%` 的有96.7%（Figure S2 C,D）。说明本次实验有良好的稳定性及重复性，数据可靠。

我们对最终用于后续分析的776个features做了PCA分析，前三个主成分分别可以解释20.22%,13.75%,10.18%的variation。成年黄精与幼年黄精具有明显的差异(Figure 1 A) ，介于两者之间的`size4`更偏向于幼年黄精。基于classyfire数据库分类的结果表明这些化合物主要为Carboxylic acids and derivatives (12.72%),Benzene and substituted derivatives(10.79%),Organooxygen compounds(9.5%),Prenol lipids(9.5%)以及Fatty Acyls(8.2) （Figure 2 B,C）. 其中Carboxylic acids and derivatives类别中主要是一些Amino acids, Benzene and substituted derivatives类别下主要为一些Benzoic acids and derivatives,Organooxygen compounds主要为Carbohydrates and carbohydrate conjugates, Fatty Acyls中主要为Fatty acids and conjugates以及Fatty acid esters类化合物（Table S3）。除了这些主要类别外，还一定数量的苯丙烷类化合物，比如黄酮类、肉桂酸及其衍生物、香豆素及其衍生物等。




### 代谢水平成年黄精和幼年黄精存在显著差异。

为了研究成年黄精和幼年黄精之间的差异，我们首先对所有代谢物的积累模式做了k-means分类。最终我们将776个代谢物分成了12个cluster， 我们发现cluster5，cluster6，cluster7整体表现为在juvenile中积累量低，而在adult中含量相对较高，(Figure 2. D), 结果表明cluster7中存在一些多糖类物质，例如棉子糖、纤维五糖及纤维六糖，不饱和脂肪酸类物质，不如亚麻酸和α-亚油酸，苯丙烷类物质，对香豆酸，肉桂酸以及柚皮素等（Table S1）。由于野外采样造成的个体差异较大，假设代谢组数据的高维性，我们在通过one-way anova分析差异代谢物的同时加入了OPLS-DA去消减组内差异。最终我们得到了77个差异积累的代谢物（pvalue < 0.05, abs(log2fc) > 0.26）,VIP > 1。其中显著下调的有7个,上调的有70个，最终我们发现存在于cluster6和cluster7中的多糖类物质以及不饱和脂肪酸类物质均存在显著差异（Figure 3 DAM analysis）



<center>**表1. 数据清洗步骤中feature数量的统计**</center>

| Ion      | original | remove noise | Annotation |
|----------|----------|--------------|------------|
| Negative | 12316    | 2156         | 362        |
| Positive | 16809    | 3962         | 414        |
| total    | 29125    | 6618         | 776        |



::: {#fig-batcheffect layout-nrow=2}
![Figure S1. Batch effect detection](FigS1.batch_effect_boxplot.png){#figS1-Boxplot}  

![FigureS2. Raw data pca](FigS2.raw_data_pca.png){#figS2-pca}

batch effect
:::

*Figure legend* Figure S1. The auto-scaled intensity box plots of QC samples before and after SVR normalization.



```{r,message=FALSE, warning=FALSE, include=FALSE, out.width='100%'}
library(tidymass)
library(IMOtoolkits)
```

```{r,echo=FALSE, message=FALSE, warning=FALSE}
load("../03.Progress/01.Metabolomics/Data_cleaning/object_origin_merge.rds")
a =
IMOtoolkits::IMO_plt_pca(obj = object_origin,tag = "group",center = T,scale = T,removeVar = .1,interactive = T,showImage = F)

a$plot
```

::: {#fig-overview layout-ncol="1"}
![Figure 2. overview of metabolomics data](Fig2.Metabo_overview.png){#fig2-overview}

*Figure legend: * Overview of metabolomics data. A. PCA result of annotated compounds. Coordinates x,y and z represent first 3 component of PCA analysis result, numbers in parentheses represents the variance explanation rate of corresponding component. B.Compounds Major class. Major class means classes with compounds number more than 10, C. Compound Minor class, Classes with compounds number between 3 to 10. D. Accumulation profile of all annotated compounds. Numbers in left means clusters number of k-means. line diagram in left represents the log10 transformed average peak area of correspoding clusters. 

overview
:::



::: {#fig-overview layout-ncol="1"}
![Figure 3. DAM analysis](Fig3.DAM.png){#fig3-DAM}

overview
:::

<center>**表2. 差异代谢物**</center>

```{r,echo=FALSE, message=FALSE, warning=FALSE,}
Table2 <- import("../04.Result/01.Tables/Table2.DAM.xlsx",sheet = 1)
colnames(Table2) = Table2[1,]
Table2 = Table2[2:10,]
Table2 <-
  Table2 %>% 
  mutate(Adult = as.numeric(Adult),
         Juvenal = as.numeric(Juvenal),
         pvalue = as.numeric(pvalue),
         FDR = as.numeric(FDR),
         VIP = as.numeric(VIP),
         log2fc = as.numeric(log2fc))
print_table(Table2,digits = 2)
```

## 讨论

**方法上，个体差异**  

我们从Figure S2的PCA结果中发现个体差异还是比较明显的，但是整体幼年材料和成年材料差异较为明显，由于植物中存在大量次生代谢物，这些次生代谢物稳定性较差，所以整体上会放大个体差异。所以在后续代谢物差异分析的时候我们加入了OPLS-DA去控制组内个体差异，从而找到幼年与成年黄精块茎中主要差异代谢物。

**功能上**

这个等后续联合分析完结合转录的数据，目前认为要从以下3方面入手：

1. 多糖类（棉子糖、纤维五糖、纤维六糖（寡糖？））膳食纤维 ==> 增加饱腹感 ==> 预防肥胖.  

2. 不饱和脂肪酸类（亚油酸、α-亚麻酸）==> 预防心血管疾病（CVD）.

3. 苯丙烷类（柚皮素、羟基肉桂酸、香豆酸）==> 抗氧化、抗衰老.

